<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml"
        xmlns:jr="http://openrosa.org/javarosa"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <h:head>
        <h:title>double repeat</h:title>
        <model>
            <instance>
                <data name="double repeat"
                      uiVersion="1"
                      version="57"
                      xmlns="http://openrosa.org/formdesigner/313BF9C4-9DF3-4B92-A111-1AB7306EA8CA">
                    <how_many/>
                    <init_weight/>
                    <tmp_bmi/>
                    <current_index/>
                    <heaviest_animal_weight/>
                    <lightest_animal_weight/>
                    <animals jr:template="">
                        <weight/>
                        <bmi/>
                    </animals>
                </data>
            </instance>
            <bind nodeset="/data/how_many" type="xsd:int"/>
            <bind nodeset="/data/init_weight"/>
            <bind calculate="/data/animals[/data/current_index]/weight" nodeset="/data/tmp_bmi"/>
            <bind calculate="count(/data/animals)" nodeset="/data/current_index"/>
            <bind calculate="max(/data/animals/weight)" nodeset="/data/heaviest_animal_weight"/>
            <bind calculate="min(/data/animals/weight)" nodeset="/data/lightest_animal_weight"/>
            <bind nodeset="/data/animals"/>
            <bind calculate="/data/init_weight - (100 * /data/current_index)"
                  nodeset="/data/animals/weight"/>
            <bind nodeset="/data/animals/bmi"/>
            <setvalue event="xforms-ready" ref="/data/init_weight" value="500"/>
            <setvalue event="xforms-ready" ref="/data/how_many" value="3"/>
            <setvalue event="jr-insert" ref="/data/animals/weight" value="50"/>
            <setvalue event="jr-insert" ref="/data/animals/bmi" value="/data/tmp_bmi * 0.5"/>
            <itext>
                <translation default="" lang="en">
                    <text id="how_many-label">
                        <value>how_many</value>
                    </text>
                    <text id="animals-label">
                        <value>animals</value>
                    </text>
                </translation>
            </itext>
        </model>
    </h:head>
    <h:body>
        <group>
            <label ref="jr:itext('animals-label')"/>
            <repeat nodeset="/data/animals" jr:count="/data/how_many" jr:noAddRemove="true()"/>
        </group>
    </h:body>
</h:html>